/*!
 * ngOpenFB v0.0.4
 * http://cjpatoilo.com/angular-openfb
 *
 * Copyright (c) 2017 CJ Patoilo
 * Licensed under the MIT license
 */

"use strict";var openFB=function(){function e(e){var o;a=!0,e.indexOf("access_token=")>0?(o=n(e.substr(e.indexOf("#")+1)),d.fbAccessToken=o.access_token,r&&r({status:"connected",authResponse:{accessToken:o.access_token}})):e.indexOf("error=")>0?(o=n(e.substring(e.indexOf("?")+1,e.indexOf("#"))),r&&r({status:"not_authorized",error:o.error})):r&&r({status:"not_authorized"})}function o(e){var o,n=e.method||"GET",s=e.params||{},r=new window.XMLHttpRequest;s.access_token=d.fbAccessToken,o="https://graph.facebook.com"+e.path+"?"+t(s),r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status)e.success&&e.success(JSON.parse(r.responseText));else{var o=r.responseText?JSON.parse(r.responseText).error:{message:"An error has occurred"};e.error&&e.error(o)}},r.open(n,o,!0),r.send()}function n(e){var o={};return decodeURIComponent(e).split("&").forEach(function(e){var n=e.split("=");o[n[0]]=n[1]}),o}function t(e){var o=[];for(var n in e)e.hasOwnProperty(n)&&o.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return o.join("&")}var s,r,c,a,i="https://www.facebook.com/dialog/oauth",u="https://www.facebook.com/logout.php",d=window.sessionStorage,l=window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/")),p=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+l,f=p+"/oauthcallback.html",w="https://www.facebook.com/connect/login_success.html",h=p+"/logoutcallback.html";return document.addEventListener("deviceready",function(){c=!0},!1),{init:function(e){if(!e.appId)throw new Error("appId parameter not set in init()");s=e.appId,e.tokenStore&&(d=e.tokenStore),e.accessToken&&(d.fbAccessToken=e.accessToken),i=e.loginURL||i,u=e.logoutURL||u,f=e.oauthRedirectURL||f,w=e.cordovaOAuthRedirectURL||w,h=e.logoutRedirectURL||h},login:function(o,n){function t(){console.log("stop listeners")}function u(){console.log("exit and remove listeners"),r&&!a&&r({status:"user_cancelled"}),d.removeEventListener("loadstop",t),d.removeEventListener("exit",u),d=null,console.log("done removing listeners")}var d,l,p="",h=c?w:f;if(!s)return o({status:"unknown",error:"Facebook App Id not set."});n&&n.scope&&(p=n.scope),r=o,a=!1,l=(new Date).getTime(),d=window.open(i+"?client_id="+s+"&redirect_uri="+h+"&response_type=token&scope="+p,"_blank","location=no,clearcache=yes"),c&&(d.addEventListener("loadstart",function(o){var n=o.url;if(n.indexOf("access_token=")>0||n.indexOf("error=")>0){var t=600-((new Date).getTime()-l);setTimeout(function(){return d.close()},t>0?t:0),e(n)}}),d.addEventListener("exit",u))},logout:function(e){var o,n=d.fbAccessToken;d.removeItem("fbtoken"),n&&(o=window.open(u+"?access_token="+n+"&next="+h,"_blank","location=no,clearcache=yes"),c&&setTimeout(function(){return o.close()},700)),e&&e()},revokePermissions:function(e,n){return o({method:"DELETE",path:"/me/permissions",success:e,error:n})},api:o,oauthCallback:e,getLoginStatus:function(e){var o=d.fbAccessToken,n={};o?(n.status="connected",n.authResponse={accessToken:o}):n.status="unknown",e&&e(n)}}}();
